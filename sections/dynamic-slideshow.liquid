<script
  type="application/json"
  data-section-type="dynamic-slideshow"
  data-section-id="{{ section.id }}"
  data-section-data
>
  {
    "enable_autoplay": {{ section.settings.should_autoplay | json }},
    "autoplay_interval": {{ section.settings.slide_frequency | json }},
    "mobile_navigation_adjust": {{ true | json }},
    "next_text": {{ 'slideshow.next_slide' | t | json }},
    "previous_text": {{ 'slideshow.previous_slide' | t | json }}
  }
</script>

<script type="application/pxs-animation-mapping+json">
  {
    "blocks": [
      ".slideshow-slide"
    ],
    "elements": [
      ".slideshow-slide__heading",
      ".slideshow-slide__text",
      ".slideshow-slide__button"
    ]
  }
</script>

<section
  class="
    slideshow
    slideshow--size-{{ section.settings.aspect_ratio }}
    {% if section.settings.show_border == false %}
      no-section-border
    {% endif %}
  "
  aria-label="{{ 'slideshow.slideshow' | t }}"
  data-autoplay="{% if section.settings.should_autoplay %}true{% else %}false{% endif %}"
  data-autoplay-interval="{{ section.settings.slide_frequency }}"
>
  <div class="slideshow__wrapper" data-slideshow-wrapper>
    {% for block in section.blocks %}
      {% liquid
        assign image = block.settings.image
        assign placeholder_number = forloop.index | modulo: 2 | plus: 1
        assign placeholder = 'lifestyle-' | append: placeholder_number
        assign slide_number = forloop.index

        # Lazy load off-screen images.
        assign lazy_load = true
        assign fetch_priority = nil

        if forloop.first and section.index == 1
          assign lazy_load = false
          assign fetch_priority = 'fetchpriority="high"'
        endif

        # Determine the overlay opacity
        assign overlay_opacity = 0
        if block.settings.background_color_opacity > 0
          assign overlay_opacity = block.settings.background_color_opacity | times: 0.01
        endif
      %}

      <article
        class="slideshow-slide"
        aria-label="{{ 'slideshow.slide_counter' | t: count: slide_number, total: section.blocks.size }}"
        {% if block.settings.color != blank %}
          data-text-color="{{ block.settings.color }}"
        {% endif %}
        tabindex="-1"
        data-slideshow-slide
        data-slideshow-slide-index="{{ forloop.index0 }}"
        {{ block.shopify_attributes }}
      >
        <div class="slideshow-slide__image-wrapper" data-slide-image-wrapper>
          {%- if image != blank -%}
            {%
              render 'rimg',
              img: image,
              class: 'slideshow-slide__image',
              size: '2000x2000',
              lazy: lazy_load,
              canvas: lazy_load,
              focal_point: image.presentation.focal_point,
              attr: fetch_priority,
            %}
          {%- else -%}
            {{ placeholder |  placeholder_svg_tag: 'slideshow-slide__image slideshow-slide__placeholder' }}
          {%- endif -%}

          {%- if block.settings.background_color_opacity != 0 and block.settings.background_color != 'rgba(0,0,0,0)' -%}
            <div
              class="slideshow-slide__overlay"
              style="
                {% if block.settings.background_color != blank %}
                  background-color: {{ block.settings.background_color }};
                {% endif %}
                opacity: {{ overlay_opacity }};
              "
            ></div>
          {%- endif -%}
        </div>

        {%- if block.settings.link != blank and block.settings.button_label == blank -%}
          <a
            href="{{ block.settings.link }}"
            class="slideshow-slide__background-link"
            tabindex="-1"
          >
          </a>
        {%- endif -%}

        <div
          class="
            slideshow-slide__content
            slideshow-slide__content--{{ block.id }}
            {% if block.settings.alignment %}
              slideshow-slide__content--text-{{ block.settings.alignment }}
            {% endif %}
          "
          {% if block.settings.color != blank %}
            style="color: {{ block.settings.color }}"
          {% endif %}
          data-slide-content
        >
          {%- if block.settings.title != blank -%}
            <h2 class="slideshow-slide__heading">
              {{ block.settings.title }}
            </h2>
          {%- endif -%}

          {%- if block.settings.subheading != blank -%}
            <p class="slideshow-slide__text">
              {{ block.settings.subheading }}
            </p>
          {%- endif -%}

          {%- if block.settings.button_label != blank and block.settings.link != blank -%}
            <a
              href="{{ block.settings.link }}"
              class="slideshow-slide__button"
            >
              {{ block.settings.button_label }}
            </a>
          {%- endif -%}
        </div>
      </article>
    {% endfor %}
  </div>

  <div
    class="slideshow__current-slide visually-hidden"
    aria-live="polite"
    aria-atomic="true"
    data-slide-counter
    data-counter-template="{{ 'slideshow.slide_counter' | t }}"
  >
  </div>
</section>

{% schema %}
{
  "name": "t:sections.slideshow.name",
  "max_blocks": 5,
  "settings": [
    {
      "type": "checkbox",
      "id": "show_border",
      "label": "t:sections.slideshow.show_border.label",
      "default": true
    },
    {
      "id": "should_autoplay",
      "type": "checkbox",
      "label": "t:sections.slideshow.should_autoplay.label",
      "default": true
    },
    {
      "type": "range",
      "id": "slide_frequency",
      "label": "t:sections.slideshow.slide_frequency.label",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 3
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "t:sections.slideshow.aspect_ratio.label",
      "options": [
        {
          "label": "t:sections.slideshow.aspect_ratio.option_1",
          "value": "23-9"
        },
        {
          "label": "t:sections.slideshow.aspect_ratio.option_2",
          "value": "2-1"
        },
        {
          "label": "t:sections.slideshow.aspect_ratio.option_3",
          "value": "8-5"
        },
        {
          "label": "t:sections.slideshow.aspect_ratio.option_4",
          "value": "original"
        }
      ]
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "t:sections.slideshow.blocks.feature.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.slideshow.blocks.feature.image.label",
          "info": "t:sections.slideshow.blocks.feature.image.info"
        },
        {
          "type": "header",
          "content": "t:sections.slideshow.blocks.feature.header_1.content"
        },
        {
          "type": "text",
          "id": "title",
          "label": "t:sections.slideshow.blocks.feature.title.label",
          "default": "Slide"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "t:sections.slideshow.blocks.feature.subheading.label",
          "default": "Introduce customers to your shop with lifestyle and product imagery"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "t:sections.slideshow.blocks.feature.button_label.label",
          "default": "Button"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.slideshow.blocks.feature.link.label"
        },
        {
          "type": "color",
          "id": "color",
          "label": "t:sections.slideshow.blocks.feature.color.label",
          "default": "#FFFFFF"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "t:sections.slideshow.blocks.feature.background_color.label",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "background_color_opacity",
          "label": "t:sections.slideshow.blocks.feature.background_color_opacity.label",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50
        },
        {
          "type": "select",
          "id": "alignment",
          "label": "t:sections.slideshow.blocks.feature.alignment.label",
          "options": [
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_1",
              "value": "left-top"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_2",
              "value": "left-center"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_3",
              "value": "left-bottom"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_4",
              "value": "center-top"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_5",
              "value": "center-center"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_6",
              "value": "center-bottom"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_7",
              "value": "right-top"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_8",
              "value": "right-center"
            },
            {
              "label": "t:sections.slideshow.blocks.feature.alignment.option_9",
              "value": "right-bottom"
            }
          ],
          "default": "center-center"
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "t:sections.slideshow.presets.category",
      "name": "t:sections.slideshow.presets.name",
      "blocks": [
        {
          "type": "feature"
        },
        {
          "type": "feature"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": [
      "*"
    ]
  }
}

{% endschema %}