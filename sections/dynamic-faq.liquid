{% liquid
  assign section = section
  assign summary_id = 'title'
  assign content_id = 'content'
  assign icon = 'icon-chevron-small'
  assign section_heading = section.settings.title

  if section.settings.show_border == false
    assign section_classes = 'no-section-border'
  endif
%}

{% if template.suffix == 'faq' %}
  {% assign faq_blocks = section.blocks | where: "type", "question" %}

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {% for faq in faq_blocks %}
          {
            "@type": "Question",
            "name": "{{ faq.settings.title | escape }}",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "{{ faq.settings.content | strip_html | escape }}"
            }
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    }
  </script>
{% endif %}

{% comment %}Inject @pixelunion/pxs-faq/faq begin{% endcomment %}
{% comment %}
  @param section {Object}
    Section object

  @param section_classes {String}
    Space-separated classes to apply to the section element

  @param section_attributes {String}
    Space-separated attributes to apply to the section element

  @param section_heading {String}
    Section heading

  @param section_subheading {String}
    Section subheading

  @param wrapper_classes {String}
    Space-separated classes to apply to the wrapper class

  @param wrapper_attributes {String}
    Space-separated attributes to apply to the wrapper class

  @param summary_id {String}
    Block setting ID for the question/summary content

  @param content_id {String}
    Block setting ID for the answer/accordion content field

  @param icon {String}
    The summary icon
{% endcomment %}

{% liquid
  assign section_classes = section_classes | default: ''
  assign section_attributes = section_attributes | default: ''
  assign section_heading = section_heading | default: ''
  assign section_subheading = section_subheading | default: ''
  assign wrapper_classes = wrapper_classes | default: ''
  assign wrapper_attributes = wrapper_attributes | default: ''
  assign summary_id = summary_id | default: nil
  assign content_id = content_id | default: nil
  assign icon = icon | default: nil
%}

<script
  type="application/json"
  data-section-type="pxs-faq"
  data-section-id="{{ section.id }}"
>
</script>

<section
  class="
    faq
    {{ section_classes }}
  "
  {{ section_attributes }}
  aria-label="{{ section_heading }}"
>
  {% if section_heading != blank or section_subheading != blank %}
    <div class="section-header faq__section-header">
      {% if section_heading != blank %}
        <h2 class="section-header__heading faq__section-heading">
          {{ section_heading | escape }}
        </h2>
      {% endif %}

      {% if section_subheading != blank %}
        <div class="section-header__subheading faq__section-subheading">
          {{ section_subheading }}
        </div>
      {% endif %}
    </div>
  {% endif %}

  <div
    class="
      section-wrapper
      faq__section-wrapper
      {{ wrapper_classes }}
    "
    {{ wrapper_attributes }}
    data-faq
  >
    <div class="section-content faq__section-content">
      {% for block in section.blocks %}
        {% if block.settings[summary_id] %}
          {% assign summary = block.settings[summary_id] %}
        {% else %}
          {% capture summary %}
            {{ 'sections.faq.summary' | t }}
          {% endcapture %}
        {% endif %}

        {% if block.settings[content_id] %}
          {% assign content = block.settings[content_id] %}
        {% else %}
          {% capture content %}
            {{ 'sections.faq.content' | t }}
          {% endcapture %}
        {% endif %}

        {%
          render 'faq-item',
          block: block,
          icon: icon,
          content: content,
          summary: summary,
          index: forloop.index0,
        %}
      {% endfor %}
    </div>
  </div>
</section>
{% comment %}Inject @pixelunion/pxs-faq/faq end{% endcomment %}


{% schema %}
{
  "name": "t:sections.faq.name",
  "class": "shopify-section--faq",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.faq.title.label",
      "default": "FAQ"
    },
    {
      "type": "checkbox",
      "id": "show_border",
      "label": "t:sections.faq.show_border.label",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "heading",
      "name": "t:sections.faq.blocks.heading.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.faq.blocks.heading.heading.label",
          "default": "Section heading"
        }
      ]
    },
    {
      "type": "question",
      "name": "t:sections.faq.blocks.question.name",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "t:sections.faq.blocks.question.title.label",
          "default": "Frequently asked question"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "t:sections.faq.blocks.question.content.label",
          "default": "<p>Use this text to provide answers for your most commonly asked questions.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "t:sections.faq.presets.category",
      "name": "t:sections.faq.presets.name",
      "settings": {
        "title": "FAQ"
      },
      "blocks": [
        {
          "type": "heading",
          "settings": {
            "heading": "Orders"
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "Frequently asked question"
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "Frequently asked question"
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "Frequently asked question"
          }
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": [
      "*"
    ]
  }
}

{% endschema %}